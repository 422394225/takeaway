<#include "../base/main/_dashboard.html"/>
<#assign pageMeta>
</#assign>
<#assign pageCss>
<link href="${base}/resources/jQuery/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css" />
</#assign>
<#assign pageJavascript>
<script src="${base}/resources/jQuery/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="${base}/resources/jQuery/dataTables.bootstrap.min.js" type="text/javascript"></script>
<script>
	$(function(){
		var table = Kit.table("#table",
		{
			"ajax": "${base}/food/getData",
	        "columns": [
	            { "data": "NAME" },
	            { "data": "IMG"},
	            { "data": "PRICE"},
	            { "data": "ORIGN_PRICE"},
	            { "data": "TYPE_NAME"},
	            { "data": "DESCRIPTION"},
	            { "data": "SALE_NUM"},
	            { "data": "CREATE_TIME"},
	            { "data": "SHOP_NAME"}
	        ],
	        "columnDefs":[{
	            "targets": -1,
	            "data": null,
	            "defaultContent": "<button class='histroy btn btn-info btn-xs' title='查看历史记录'><i class='fa fa-history'></i>"+
	            				  "</button><button class='edit btn btn-success btn-xs' title='修改'><i class='fa fa-edit'></i></button>"+
	        					  "<button class='xiajia btn btn-danger btn-xs' title='下架'><i class='fa fa-caret-down fa-lg'></i></button>"
	        },{
	        	"targets": 2,
	            "render": function(data, type, row) {
	            	if(data==null)
	              	  return "没有图片";
	            	else
	              	  return "<img src='"+data+"' style='width:50px;height:50px'/>";
	            }
	        }],
	        "order": [[ 8, "desc" ]]
		});
		table.on('click', '.histroy', function(){
	        var data = table.row($(this).parents('tr')).data();
	        BootstrapDialog.show({
				title: data['NAME'],
				draggable: true,
				size: BootstrapDialog.SIZE_WIDE,
			    message: $('<div></div>').load('${base}/food/histroy?GOOD_NAME='+data["NAME"]+'&SHOP_ID='+data["SHOP_ID"]),
			    buttons: [{
			        label: '关闭',
			        cssClass: 'btn btn-primary btn-lg btn-block', 
			        action: function(dialogRef){    
			            dialogRef.close();
			        }
			    }]
	        });
	    });
		$(".reload").on("click",function(){
			table.ajax.reload(null, false);// 刷新表格数据，分页信息不会重置
		})
		$(".add").on("click",function(){
			BootstrapDialog.show({
				title: '添加商品',
				draggable: true,
			    message: $('<div></div>').load('${base}/food/add'),
			    buttons: [{
			    	id:'submitBtn',
			        label: '提交',
			        cssClass: 'btn btn-primary', 
			        action: function(dialogRef){    
			           
			        }
			    },{
			        label: '取消',
			        cssClass: 'btn btn-link', 
			        action: function(dialogRef){    
			            dialogRef.close();
			        }
			    }]
	        });
		});
		table.on("click",'.xiajia',function(){
	        var data = table.row($(this).parents('tr')).data();
			var foodId=data['ID'];
			BootstrapDialog.show({
			title: '是否下架商品',
            message: '下架了要记得提醒商家~n(*≧▽≦*)n',
            buttons: [{
                label: '是',
                action: function(dialogItself){
                	 $.ajax({
                	        url: '/food/offShelf?foodId='+foodId, // /api/leds/1
                	        async: true,
                	        type: 'GET',
                	        success: function(data , textStatus){
                	          if(data=="success"){
                    	          window.location.href='/food';
                	      	  }
                	          else{
                	        	  console.log("error to off shelf");
                	        	  layer.msg("操作失败");
                	        	  dialogItself.close();
                	          }
                	        },
                	       
                	        error: function(jqXHR , textStatus , errorThrown){
                	          console.log("error");
                	        },
                	       
                	      });
                }
            }, {
                label: '否',
                action: function(dialogItself){
                    dialogItself.close();
                }
            }]
        });
		})
		table.on("click",'.edit',function(){
	        var data = table.row($(this).parents('tr')).data();
			var foodId=data['ID'];
			BootstrapDialog.show({
				title: '编辑商品',
				draggable: true,
			    message: $('<div></div>').load('${base}/food/edit?foodId='+foodId),
			    buttons: [{
			    	id:'submitBtn',
			        label: '提交',
			        cssClass: 'btn btn-primary', 
			        action: function(dialogRef){    
			           
			        }
			    },{
			        label: '取消',
			        cssClass: 'btn btn-link', 
			        action: function(dialogRef){    
			            dialogRef.close();
			        }
			    }]
	        });
		});
	})
</script>
</#assign>
<@dashboard pageTitle="商品列表" pageMeta=pageMeta pageCss=pageCss pageJavascript=pageJavascript currentMenu="food">
<@tool map="系统管理-商品列表">
   <div class='btn-group'>
	<button class="add btn btn-light btn-sm radius" title="添加" data-toggle="tooltip" data-placement="bottom">
     	<i class="fa fa-plus"></i>
	</button>
     <button class="reload btn btn-light btn-sm radius" title="刷新" data-toggle="tooltip" data-placement="bottom">
     	<i class="fa fa-refresh"></i>
     </button>
   </div>
</@tool>
<div id='content'>
  <table class='table table-bordered' id="table">
    <thead>
      <tr>
     	<th>序号</th>
        <th>名称</th>
        <th>图片</th>
        <th>价格</th>
        <th>原价</th>
        <th>分类</th>
        <th>简介</th>
        <th>销量</th>
        <th>创建时间</th>
        <th>商店名</th>
        <th>查看所有变更</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</@dashboard>