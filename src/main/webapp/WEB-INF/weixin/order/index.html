<#include "../base/main/_main.html"/>
<#assign wxMeta>
</#assign>
<#assign wxCss>
</#assign>
<#assign wxJavascript>
</#assign>
<@mainLayout wxTitle="点单"  wxMeta=wxMeta wxCss=wxCss wxJavascript=wxJavascript>
<a href="wx/order/interShop?shopId=2&openid=${user.ID}">点这里</a>
<button onclick="preOrder()">提交预订单</button>
<div>
<a id="sss">
</a></div><div>
<a id="orderid">
</a></div><div>
<a id="prepay_id">
</a></div>
</@mainLayout>
<script>
if (typeof WeixinJSBridge == "undefined"){
	   if( document.addEventListener ){
	       document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
	   }else if (document.attachEvent){
	       document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
	       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
	   }
	}else{
	   onBridgeReady();
	}
function preOrder(){
$.post("wx/order/createOrder",{shopid:"2",userAddress:"address",userTel:"tel",userName:"username",foods:"[{id:35,num:1},{id:38,num:4}]"},function(result){
	alert(result.error)
    $("#sss").html(result.error);
	if(result.error==false){
	    WeixinJSBridge.invoke(
   	       'getBrandWCPayRequest', {
   	           "appId":result.data.appId,     //公众号名称，由商户传入     
   	           "timeStamp":result.data.timeStamp,         //时间戳，自1970年以来的秒数     
   	           "nonceStr":result.data.nonceStr, //随机串     
   	           "package":result.data.package1,     
   	           "signType":result.data.signType,         //微信签名方式：     
   	           "paySign":result.data.paySign //微信签名 
   	       },
   	       function(res){
   	    	   alert(res.err_msg);
   	           if(res.err_msg == "get_brand_wcpay_request:ok" ) {}     // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。 
   	       }
   	   ); 
	}
	}
  );
}
</script>